---
title: "ADPS 20L --- wiczenie 4 - rozwizania"
author: "Gabriel R."
output:
  pdf_document: 
    latex_engine: xelatex
  html_document: default
  html_notebook: default
---

```{r, echo=FALSE}
pdf.options(encoding='ISOLatin2')
```


Dla wszystkich zada, gdzie bdzie wystpowa $\alpha$ zostaje odg贸rnie 
przyjta warto $\alpha$ = 0.05.


# Zadanie 1

## Tre zadania

Korzystajc z metod analizy wariancji, dla wybranej sp贸ki notowanej na GPW
zweryfikuj hipotez o r贸wnoci wartoci rednich procentowych zmian cen
zamknicia:

* por贸wnujc rednie w ostatnich szeciu miesicach,
* por贸wnujc rednie w ostatnich trzech miesicach.

Wskaz贸wki:

* obliczenie procentowych zmian cen zamknicia:
dane$close_ch = with(dane, c(NA, 100*diff(close)/close[-length(close)]))

* przykadowy spos贸b wczytania danych dot. np. sierpnia 2019:
x1 = with(dane, close_ch[format(date, '%Y-%m') == '2019-08'])

## Rozwizanie

1. Zapisuj plik mstall.zip do katalogu ADPS/Lab4
```{r}
if(!file.exists('mstall.zip')) {
  download.file('http://bossa.pl/pub/metastock/mstock/mstall.zip','mstall.zip')
}
```

2. Wybieram sp贸k ZUE. Wczytuj plik do zmiennej dane, obliczam procentowy 
zmiany zamknicia (dane$close_ch):
```{r}
unzip('mstall.zip', 'ZUE.mst')
dane <- read.csv('ZUE.mst')
names(dane) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
dane$date = as.Date.character(dane$date, format ='%Y%m%d')
dane$close_ch = with(dane, c(NA, 100*diff(close)/close[-length(close)]))
```



Zao偶enie:
W celu uniknicia powt贸rze dla wszystkich oblicze w zadaniu nr 1 przyjmuj
poziom istotnoci $\alpha$ r贸wne 0.05.



A) Dla 6 miesicy -------------------------------------------------------------- 

3. Wczytuj zmiany dla wariantu 6-miesicznego (ostatnie 6 miesicy):
```{r}
x1 <- with(dane, close_ch[format(date, '%Y-%m') == '2020-04'])
x2 <- with(dane, close_ch[format(date, '%Y-%m') == '2020-03'])
x3 <- with(dane, close_ch[format(date, '%Y-%m') == '2020-02'])
x4 <- with(dane, close_ch[format(date, '%Y-%m') == '2020-01'])
x5 <- with(dane, close_ch[format(date, '%Y-%m') == '2019-12'])
x6 <- with(dane, close_ch[format(date, '%Y-%m') == '2019-11'])
```

4. Wywietlam wykres pudekowy dla powy偶szych danych:
```{r}

wykres_pudelkowy_6mc <- boxplot(x1,x2,x3,x4,x5,x6,
main = 'ZUE',
names = c('11-2019', '12-2019', '01-2020', '02-2020', '03-2020', '04-2020'),
ylab = 'procentowe zmiany cen zamknicia')

wykres_pudelkowy_6mc
```

5. Przypisuj dane do zmiennej dane_anova:
```{r}
dane_anova = data.frame( dane = c(x1, x2, x3, x4, x5, x6),
  proba = rep( c('x1', 'x2', 'x3', 'x4', 'x5', 'x6'), 
  times = c(length(x1), length(x2), length(x3), 
          length(x4), length(x5), length(x6))) )
```

6. Sprawdzam hipotez o r贸wnoci wariancji w pr贸bach teste Barletta:
```{r}
bTest <- bartlett.test(dane~proba, data = dane_anova)
print(bTest)
```

Weryfikuj hipotez H0 wobec hipotezy H1, gdzie:
H0 - Wariancje pr贸b s takie same.
H1 - Wariancje pr贸b s r贸偶ne.

Wniosek:
Z testu Barletta otrzymalimy $/p-value$ r贸wne 0.0006993 (< $\alpha$ = 0.05). 
Oznacza to, 偶e mamy podstaw do odrzucenia hipotezy H0.

Wg otrzymanego p-value < $\alpha$ powinnimy odrzuci
nale偶aoby odrzuci hipotez H0, niemniej w oparciu o wytyczne podane na
laboratorium nr 4 przechodzimy do dalszej analizy nie odrzucajc H0 (zatem
mo偶emy wynoka test aov_res).


7. Przeprowadzam analiz wariancji przy zao偶eniu normalnoci rozkad贸w:
```{r}
aov_res <- aov(dane~proba, data = dane_anova)
summary(aov_res)
```

Weryfikuj hipotez H0 wobec hipotezy H1, gdzie:
H0 - rednie wartoci pr贸b s r贸wne.
H1 - Przynajmniej jedna ze rednich r贸偶na od pozostaych.

Wniosek:
$P-value$ testu z analizy wariancji na podstawie rozkadu F-Snedecora r贸wne 
0.802 (>$\alpha$) jednoznacznie wskazuje, 偶e nie ma podstaw do odrzucenia 
hipotezy H0 m贸wicej o r贸wnoci wartoci rednich w  pr贸bach x1, x2, x3, x4, x5
x6.

8. Korzystajc z testu Kruskala-Wallisa przeprowadzam analiz wariancji bez
zakadania normalnoci rozkad贸w:
```{r}
kTest <- kruskal.test(dane~proba, data = dane_anova)
print(kTest)
```

Weryfikuj hipotez H0 wobec hipotezy H1, gdzie:
H0 - rednie wartoci pr贸b s r贸wne.
H1 - Przynajmniej jedna ze rednich r贸偶na od pozostaych.

Wniosek:
$P-value$ r贸wne 0.5984 (> $/alpha$) jednoznacznie wskazuje, 偶e nie ma podstaw 
do odrzucenia hipotezy H0 m贸wicej o r贸wnoci wartoci rednich.

9. Metod Tukeya sprawdzam, czy dla kt贸rej z pr贸b jej warto rednia odbiega 
od wartoci rednich w pozostaych pr贸bach:
```{r}
Tukey = TukeyHSD(aov_res)
print(Tukey)
plot(Tukey)
```
Wniosek:
Wszystkie przedziay ufnoci obejmuj warto 0. Jest to dodatkowe potwierdzenie 
wczeniej podjtych decyzji o nieodrzuceniu hipotezy H0.

B) Dla 3 miesicy -------------------------------------------------------------- 

1.  Przyjmuj wczytane uprzednio dane dla okresu 3-miesicznego dla:
x1, x2, x3.

2. Wywietlam wykres pudekowy dla powy偶szych danych:
```{r}
wykres_pudelkowy_3mc <- boxplot(x1,x2,x3,
main = 'ZUE',
names = c('02-2020', '03-2020', '04-2020'),
ylab = 'procentowe zmiany cen zamknicia')

wykres_pudelkowy_3mc
```

3. Przypisuj dane do zmiennej dane_anova_2:
```{r}
dane_anova_ = data.frame( 
  dane = c(x1, x2, x3),
  proba = rep( c('x1', 'x2', 'x3'),times = c(length(x1), length(x2), length(x3))
  )
)
```

4. Sprawdzam hipotez o r贸wnoci wariancji w pr贸bach teste Barletta:
```{r}
bTest_ <- bartlett.test(dane~proba, data = dane_anova_)
print(bTest_)
```

Weryfikuj hipotez H0 wobec hipotezy H1, gdzie:
H0 - Wariancje pr贸b s takie same.
H1 - Wariancje pr贸b s r贸偶ne.

Wniosek:
Z testu Barletta otrzymalimy $/p-value$ r贸wne 0.002592.  

Wg otrzymanego p-value < $\alpha$ powinnimy odrzuci
nale偶aoby odrzuci hipotez H0, niemniej w oparciu o wytyczne podane na
laboratorium nr 4 przechodzimy do dalszej analizy nie odrzucajc H0 (zatem
mo偶emy wynoka test aov_res).



7. Przeprowadzam analiz wariancji przy zao偶eniu normalnoci rozkad贸w:
```{r}
aov_res_ <- aov(dane~proba, data = dane_anova_)
summary(aov_res_)
```

Weryfikuj hipotez H0 wobec hipotezy H1, gdzie:
H0 - rednie wartoci pr贸b s r贸wne.
H1 - Przynajmniej jedna ze rednich r贸偶na od pozostaych.

Wniosek:
$P-value$ testu z analizy wariancji na podstawie rozkadu F-Snedecora r贸wne 
0.9 (> $alpha$) jednoznacznie wskazuje, 偶e nie ma  podstaw do odrzucenia 
hipotezy H0 m贸wicej o r贸wnoci wartoci rednich w  pr贸bach x1, x2, x3.


8. Korzystajc z testu Kruskala-Wallisa przeprowadzam analiz wariancji bez
zakadania normalnoci rozkad贸w:
```{r}
kTest_ <- kruskal.test(dane~proba, data = dane_anova_)
print(kTest_)
```

Weryfikuj hipotez H0 wobec hipotezy H1, gdzie:
H0 - rednie wartoci pr贸b s r贸wne.
H1 - Przynajmniej jedna ze rednich r贸偶na od pozostaych.

Wniosek:
$P-value$ r贸wne 0.416 (> $/alpha$) jednoznacznie wskazuje, 偶e nie ma podstaw do
odrzucenia hipotezy H0 m贸wicej o r贸wnoci wartoci rednich.


9. Metod Tukeya sprawdzam, czy dla kt贸rej z pr贸b jej warto rednia odbiega 
od wartoci rednich w pozostaych pr贸bach:
```{r}
Tukey_ = TukeyHSD(aov_res_)
print(Tukey_)
plot(Tukey_)
```

Wniosek:
Wszystkie przedziay ufnoci obejmuj 0. Jest to dodatkowe potwierdzenie 
wczeniej podjtych decyzji o nieodrzuceniu hipotezy H0.


***


# Zadanie 2

## Tre zadania

* Korzystajc z regresji liniowej wyznacz zale偶no indeksu WIG20 od kurs贸w 
zamknicia sp贸ek COMARCH, ELZAB, GETIN, PEKAO, PGNIG, PZU dla danych z 
pierwszego kwartau roku 2020.

* Oce istotno poszczeg贸lnych zmiennych objaniajcych w tak skonstruowanym 
modelu.
* Przeprowad藕 analogiczne analizy w przypadku uwzgldnienia w modelu mniejszej 
iloci sp贸ek: COMARCH, ELZAB, GETIN.

## Rozwizanie


```{r}
rm(list=ls())
```

1. Zapisuj plik mstall.zip do katalogu ADPS/Lab4
```{r}

if(!file.exists('mstall.zip')) {
  download.file('http://bossa.pl/pub/metastock/mstock/mstall.zip','mstall.zip')
}
```

2. Wczytuj dane do zmiennych dla 6. pr贸bek i wybieram z ramek danych dane 
dotyczce kurs贸w zamknicia w zakadanym okresie:
```{r}
unzip('mstall.zip', 'WIG20.mst')
WIG20_ <- read.csv('WIG20.mst')
names(WIG20_) <- c('ticker', 'date', 'open', 'high', 'low', 'close')
WIG20_$date = as.Date.character(WIG20_$date, format ='%Y%m%d')
WIG20 = subset( WIG20_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))

unzip('mstall.zip', 'COMARCH.mst')
Comarch_ <- read.csv('COMARCH.mst')
names(Comarch_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Comarch_$date = as.Date.character(Comarch_$date, format ='%Y%m%d')
Comarch = subset( Comarch_, date >= '2020-01-01' & date < '2020-04-01', 
                  select = c('date', 'close'))

unzip('mstall.zip', 'ELZAB.mst')
Elzab_ <- read.csv('ELZAB.mst')
names(Elzab_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Elzab_$date = as.Date.character(Elzab_$date, format ='%Y%m%d')
Elzab = subset( Elzab_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))

unzip('mstall.zip', 'GETIN.mst')
Getin_ <- read.csv('GETIN.mst')
names(Getin_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Getin_$date = as.Date.character(Getin_$date, format ='%Y%m%d')
Getin = subset( Getin_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))

unzip('mstall.zip', 'PEKAO.mst')
Pekao_ <- read.csv('PEKAO.mst')
names(Pekao_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Pekao_$date = as.Date.character(Pekao_$date, format ='%Y%m%d')
Pekao = subset( Pekao_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))

unzip('mstall.zip', 'PZU.mst')
Pzu_ <- read.csv('PZU.mst')
names(Pzu_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Pzu_$date = as.Date.character(Pzu_$date, format ='%Y%m%d')
Pzu  = subset( Pzu_, date >= '2020-01-01' & date < '2020-04-01', 
               select = c('date', 'close'))

unzip('mstall.zip', 'PGNIG.mst')
Pgnig_  <- read.csv('PGNIG.mst')
names(Pgnig_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Pgnig_$date = as.Date.character(Pgnig_$date, format ='%Y%m%d')
Pgnig = subset( Pgnig_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))
```

3. Zale偶no indeksu WIG20 od kurs贸w zamknicia sp贸ek COMARCH, ELZAB, 
GETIN, PEKAO, PGNIG, PZU dla danych z pierwszego kwartau roku 2020. 
Sotsuj metod regresji liniowej:
```{r}

ALL_df0 = merge(Comarch, Elzab, by = 'date')
ALL_df0 = merge(ALL_df0, Getin, by = 'date')
ALL_df0 = merge(ALL_df0, Pekao, by = 'date')
ALL_df0 = merge(ALL_df0, Pzu, by = 'date')
ALL_df0 = merge(ALL_df0, Pgnig, by = 'date')
ALL_df0 = merge(ALL_df0, WIG20, by = 'date')

names(ALL_df0) = c('date','Comarch','Elzab','Getin','Pekao','Pzu', 'Pgnig','WIG20')

lm_res0 = lm(WIG20 ~ Comarch + Elzab + Getin + Pekao + Pzu + Pgnig, data = ALL_df0)
summary(lm_res0)

```

5. Ocena istotno poszczeg贸lnych zmiennych objaniajcych w tak skonstruowanym 
modelu:

Zao偶enie:
H0 - wspp贸czynniki s zerowe.
H1 - wsp贸czynniki s r贸偶ne od zera.

W zale偶noci od wybranej sp贸ki otrzymujemy p-value wynoszce:
a) Comarch:  0.08856
b) Elzab: 0.15875
c) Getin: 2.50e-08
d) Pekao: 9.34e-15
e) Pzu: 2.75e-12
f) Pgnig: 0.00449

Hipoteza H0 zostanie odrzucona w przypadku Getin, Pekao, Pgnig oraz Pzu.
W przypadku Comarch oraz Elzab nie ma podstaw do odrzucenia hipotezy H0 
(gdy偶 p-value jest wiksze od $\alpha$ = 0.05).




```{r}
rm(list=ls())
```

6. Przeprowadzam analogiczne analizy w przypadku uwzgldnienia w modelu 
mniejszej iloci sp贸ek: COMARCH, ELZAB, GETIN:
```{r}

unzip('mstall.zip', 'WIG20.mst')
WIG20_ <- read.csv('WIG20.mst')
names(WIG20_) <- c('ticker', 'date', 'open', 'high', 'low', 'close')
WIG20_$date = as.Date.character(WIG20_$date, format ='%Y%m%d')
WIG20 = subset( WIG20_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))

unzip('mstall.zip', 'COMARCH.mst')
Comarch_ <- read.csv('COMARCH.mst')
names(Comarch_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Comarch_$date = as.Date.character(Comarch_$date, format ='%Y%m%d')
Comarch = subset( Comarch_, date >= '2020-01-01' & date < '2020-04-01', 
                  select = c('date', 'close'))

unzip('mstall.zip', 'ELZAB.mst')
Elzab_ <- read.csv('ELZAB.mst')
names(Elzab_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Elzab_$date = as.Date.character(Elzab_$date, format ='%Y%m%d')
Elzab = subset( Elzab_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))

unzip('mstall.zip', 'GETIN.mst')
Getin_ <- read.csv('GETIN.mst')
names(Getin_) <- c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
Getin_$date = as.Date.character(Getin_$date, format ='%Y%m%d')
Getin = subset( Getin_, date >= '2020-01-01' & date < '2020-04-01', 
                select = c('date', 'close'))


```

7. Sotsuj metod regresji liniowej:
```{r}

ALL_df7 = merge(Comarch, Elzab, by = 'date')
ALL_df7 = merge(ALL_df7, Getin, by = 'date')
ALL_df7 = merge(ALL_df7, WIG20, by = 'date')

names(ALL_df7) = c('date','Comarch','Elzab','Getin','WIG20')

lm_res7 = lm(WIG20 ~ Comarch + Elzab + Getin,  data = ALL_df7)
summary(lm_res7)

```

8. Ocena istotno poszczeg贸lnych zmiennych objaniajcych w tak skonstruowanym 
modelu:

Zao偶enie:
H0 - wspp贸czynniki s zerowe.
H1 - wsp贸czynniki s r贸偶ne od zera.

W zale偶noci od wybranej sp贸ki otrzymujemy p-value wynoszce:
a) Comarch: 0.01147
b) Elzab: 0.00411
c) Getin: < 2e-16

Poniewa偶 w 偶adnym przypadku p-value nie jest wiksze od $\alpha$ = 0.05,
mamy podstaw do odrzucenia hipotezy H0 dla wszystkich sp贸ek.



***

# Zadanie 3

## Tre zadania

Korzystajc z regresji liniowej dla danych z pierwszego kwartau roku 2020 
zbadaj:

* zale偶no kursu CHF od kurs贸w EUR, USD, GBP, JPY (wykorzystaj dane z pliku 
mstnbp.zip),
* zale偶no indeksu WIG20 od indeks贸w DAX, DJIA, NIKKEI, FT-SE100 
(wykorzystaj dane z pliku mstzgr.zip*),
* zale偶no pomidzy kursem USD a indeksami giedowymi DAX, DJIA, 
NIKKEI, FT-SE100.

Uwaga: daty notowa w r贸偶nych krajach mog r贸偶ni si. 
Wskaz贸wka dot. stworzenia odpowiedniej ramki z danymi. 

* Stworzenie podramek, np. dla DJIA:
dane = read_mst('mstzgr.zip', 'DJIA.mst')
DJIA_df = subset( dane, date >= '2020-01-01' & date < '2020-04-01', 
select = c('date', 'close'))

* Poczenie danych:
ALL_df = merge(DJIA_df, NIKKEI_df, by = 'date')
ALL_df = merge(ALL_df, FT_SE100_df, by = 'date')

itd.

## Rozwizanie

```{r}
rm(list=ls())
```

1. Rozpakowuj archiwum mstnbp.zip i archiwum mstzgr.zip. Wczytuj dane 
do zmiennych:
```{r}

rm(list=ls())

read_mst = function(plik_zip, plik_mst) {
unzip(plik_zip, plik_mst)
dane = read.csv(plik_mst)
names(dane) = c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
dane$date = as.Date.character(dane$date,format = '%Y%m%d')
dane }

dane = read_mst('mstzgr.zip', 'DJIA.mst')
DJIA_df = subset( dane, date >= '2020-01-01' & date < '2020-04-01', 
                  select = c('date', 'close'))

dane1 = read_mst('mstzgr.zip', 'DAX.mst')
DAX_df = subset( dane1, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))

dane2 = read_mst('mstzgr.zip', 'NIKKEI.mst')
NIKKEI_df = subset( dane2, date >= '2020-01-01' & date < '2020-04-01', 
                    select = c('date', 'close'))

dane3 = read_mst('mstzgr.zip', 'FT-SE100.mst')
FTSE100_df = subset( dane3, date >= '2020-01-01' & date < '2020-04-01', 
                     select = c('date', 'close'))

unzip('mstall.zip', 'WIG20.mst')
WIG20_ <- read.csv('WIG20.mst')
names(WIG20_) <- c('ticker', 'date', 'open', 'high', 'low', 'close')
WIG20_$date = as.Date.character(WIG20_$date, format ='%Y%m%d')
WIG20_df = subset(WIG20_, date >= '2020-01-01' & date < '2020-04-01', 
                  select = c('date', 'close'))
```


3. Stosuj metod regresji liniowej w celu wyznaczenia mo偶liwej zale偶no 
indeksu WIG20 od indeks贸w DAX, DJIA, NIKKEI, FT-SE100:
```{r}
ALL_df = merge(DJIA_df, NIKKEI_df, by = 'date')
ALL_df = merge(ALL_df, FTSE100_df, by = 'date')
ALL_df = merge(ALL_df, DAX_df, by = 'date')
ALL_df = merge(ALL_df, WIG20_df, by = 'date')

names(ALL_df) = c('date','DJIA','NIKKEI','FTSE100','DAX', 'WIG20')

lm_res1 = lm(WIG20 ~ DJIA + NIKKEI + FTSE100 + DAX , data = ALL_df)
cat('Zale偶no indexu giedowego WIG20 od pozostaych index贸w giedowych:')
summary(lm_res1)
```

Podsumowanie:


4. Badam zale偶no kursu CHF od kurs贸w EUR, USD, GBP, JPY:
```{r}
dane4 = read_mst('mstnbp.zip', 'CHF.mst')
CHF_df = subset( dane4, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))

dane5 = read_mst('mstnbp.zip', 'EUR.mst')
EUR_df = subset( dane5, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))

dane6 = read_mst('mstnbp.zip', 'USD.mst')
USD_df = subset( dane6, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))

dane7 = read_mst('mstnbp.zip', 'GBP.mst')
GBP_df = subset( dane7, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))

dane8 = read_mst('mstnbp.zip', 'JPY.mst')
JPY_df = subset( dane8, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))

```

5. Stosuj metod regresji liniowej w celu wyznaczenia mo偶liwej zale偶no 
kursu CHF od kurs贸w
```{r}
ALL_df1 = merge(EUR_df, USD_df, by = 'date')
ALL_df1 = merge(ALL_df1, GBP_df, by = 'date')
ALL_df1 = merge(ALL_df1, JPY_df, by = 'date')
ALL_df1 = merge(ALL_df1, CHF_df, by = 'date')

names(ALL_df1) = c('date','EUR','USD','GBP','JPY', 'CHF')

lm_res2 = lm(CHF ~ EUR + USD + GBP + JPY , data = ALL_df1)
cat('Zale偶no kursu CHF od pozostaych walut: ')
summary(lm_res2)
```

Podsumowanie:

Zao偶enie:
H0 - wspp贸czynniki s zerowe.
H1 - wsp贸czynniki s r贸偶ne od zera.

W zale偶noci od wybranej waluty otrzymujemy p-value wynoszce:
a) EUR: 9.76e-07
b) USD: 0.0499
c) GBP: 0.8586
d) JPY: 5.10e-12

Jedynie w przypadku GBP  p-value  jest wiksze od $\alpha$ = 0.05,
mamy nie mamy podstawy do odrzucenia hipotezy H0 dla tej waluty.
Hipotez H0 odrzucimy w pozostaych przypadkach.


6. Badam zale偶no pomidzy kursem USD a indeksami giedowymi DAX, DJIA, NIKKEI,
FT-SE100:
```{r}
rm(list=ls())

read_mst = function(plik_zip, plik_mst) {
unzip(plik_zip, plik_mst)
dane = read.csv(plik_mst)
names(dane) = c('ticker', 'date', 'open', 'high', 'low', 'close', 'vol')
dane$date = as.Date.character(dane$date,format = '%Y%m%d')
dane }

dane = read_mst('mstzgr.zip', 'DJIA.mst')
DJIA_df = subset( dane, date >= '2020-01-01' & date < '2020-04-01', 
                  select = c('date', 'close'))

dane1 = read_mst('mstzgr.zip', 'DAX.mst')
DAX_df = subset( dane1, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))

dane2 = read_mst('mstzgr.zip', 'NIKKEI.mst')
NIKKEI_df = subset( dane2, date >= '2020-01-01' & date < '2020-04-01', 
                    select = c('date', 'close'))

dane3 = read_mst('mstzgr.zip', 'FT-SE100.mst')
FTSE100_df = subset( dane3, date >= '2020-01-01' & date < '2020-04-01', 
                     select = c('date', 'close'))

dane6 = read_mst('mstnbp.zip', 'USD.mst')
USD_df = subset( dane6, date >= '2020-01-01' & date < '2020-04-01', 
                 select = c('date', 'close'))
```

7. Stosuj metod regresji liniowej w celu wyznaczenia mo偶liwej zale偶no 
kursu USD a indeks贸w giedowych DJIA, DAX, 
```{r}
ALL_df1 = merge(DJIA_df, DAX_df, by = 'date')
ALL_df1 = merge(ALL_df1, FTSE100_df, by = 'date')
ALL_df1 = merge(ALL_df1, NIKKEI_df, by = 'date')
ALL_df1 = merge(ALL_df1, USD_df, by = 'date')

names(ALL_df1) = c('date','DJIA','DAX','FTSE100','NIKKEI', 'USD')

lm_res2 = lm(USD ~ DJIA + DAX + FTSE100 + NIKKEI , data = ALL_df1)
cat('Zale偶no kursu USD od indeks贸w giedowych: ')
summary(lm_res2)
```

Podsumowanie:

Podsumowanie:

Zao偶enie:
H0 - wspp贸czynniki s zerowe.
H1 - wsp贸czynniki s r贸偶ne od zera.

W zale偶noci od wybranej waluty otrzymujemy p-value wynoszce:
a) DJIA: 3.81e-06
b) DAX: 0.000335 
c) FTSE100: 0.000335
d) NIKKEI: 0.187650  

Jedynie w przypadku TFSE100 oraz NIKKEI  p-value  jest wiksze od $\alpha$ = 0.05,
mamy nie mamy podstawy do odrzucenia hipotezy H0 dla tej waluty.
Hipotez H0 odrzucimy w pozostaych przypadkach.


# Zadanie 4

## Tre zadania

W pliku sprzedaz.txt znajduj si dane dotyczce wydatk贸w na reklam pewnej 
firmy (w tys. z) i wartoci sprzeda偶y jej produkt贸w (w mln z) w poszczeg贸lnych 
kwartaach.

* Metod regresji liniowej wyznacz zale偶no pomidzy wartoci sprzeda偶y 
a wydatkami na reklam. Na jednym wykresie narysuj punkty odpowiadajce danym 
oraz prost regresji. 

* Oblicz prognozowane wartoci sprzeda偶y, jeli wydatki na reklam bd 
wynosiy: 300, 500, 700 tys. z.

* Oszacuj odchylenie standardowe bdu z jakim wyznaczono prognozowane wartoci 
sprzeda偶y dla poszczeg贸lnych wartoci wydatk贸w na reklam.

## Rozwizanie

```{r}
rm(list=ls())
```

1. Wczytuj dane z pliku sprzedaz.txt:
```{r}
sprzedaz = read.delim('sprzedaz.txt', sep =',')
x = sprzedaz$Advert
y = sprzedaz$Income 
n = length(x)
```

2. Przyjmuj, 偶e:
x - zmienna objaniajca - wydatki na reklam
y - warto objaniana - warto sprzeda偶y

Parametry prostej regresji wyznaczam ze wzoru:
  = 1 + :0

```{r}
z1 = (mean(x * y) - mean(x) * mean(y)) / (mean(x^2) - (mean(x))^2)
cat('Warto z1: ',z1)
z0 = mean(y) - z1 * mean(x)
cat('Warto z0:', z0)
y_1 = z1 * x + z0
cat('Warto y_1:', y_1)
```


3. Wykres danych z pliku oraz prostej regresji liniowej"
```{r}
plot(x, y, xlab = 'wydatki na reklam', ylab = 'warto sprzeda偶y')
a = c(min(x), max(x))
fin = z1 * a + z0
cat('Warto fin:',fin)
lines(a, fin, col = 'green')
```

4. Wyznaczam prognozowane wartoci sprzeda偶y. Przymuj, 偶e wydatki na reklam 
bd wynosz kolejno 300, 500 i 700 (ty. z):
```{r}
x_2 = c(300, 500, 700)
y_2 = z1 * x_2 + z0

cat('Gdzie x_2:', x_2)
cat('Gdzie y_2:', y_2)
```

5. Szacuj odchylenie standardowe bdu z jakim wyznaczono prognozowane 
wartoci sprzeda偶y dla poszczeg贸lnych wartoci wydatk贸w na reklam. 
Wykonuj obliczenia sprawdzajce:
```{r}
s2 = 1/(n - 2) * sum((y - y_1)^2)
s2_y_est = s2 * (1 + 1/n + (mean(x) - x_2)^2/(n * (mean(x^2) - mean(x)^2)))
s_y_est = sqrt(s2_y_est)


cat('Gdzie s2:', s2)
cat('Gdzie s2_y_est:', s2_y_est)
cat('Gdzie s_y_est:', s_y_est)

lm_res = lm(y ~ x)
summary(lm_res)
predict(lm_res, data.frame(x = x_2), se = T)

```

Prognozy wydatk贸w na reklamy:
Dla wydatk贸w na reklam r贸wnych:
300 tys. z, gdzie oczekiwana sprzeda偶 to  9,57 mln z
500 tys. z, gdzie oczekiwana sprzeda偶 to 12,5 mln z
700 tys. z, gdzie oczekiwana sprzeda偶 to 15,43 mln z



***

# Zadanie 5 

## Tre zadania

* Dla danych z pliku sprzedaz.txt zbadaj czy lepszym modelem zale偶noci midzy 
wartoci wydatk贸w na reklam (w tys. z) a wartoci sprzeda偶y (w mln z) 
byaby zale偶no kwadratowa.

* Nanie odpowiedni lini przedstawiajc t zale偶no na rysunek z danymi 
oraz prost regresji wyznaczon w poprzednim punkcie.


1. Wykonuj obliczenia metod lm:

```{r}
#dane x oraz y z zadania nr 4

plot(x, y, xlab = 'Wydatki na reklam [tys. z]', ylab = 'Warto sprzeda偶y 
     [mln z]')

abline(lm_res, col = 'green')  # wywoana z zadania nr 4 pkt. 3
lm_res_new = lm(y ~ x + I(x^2))
summary(lm_res_new)


eq = function(x){lm_res_new$coefficients[1] + lm_res_new$coefficients[2] * x + 
    lm_res_new$coefficients[3] * x * x }
curve(eq, from = min(x), to = max(x), add = T, col = 'red') 
# czerwona nao偶ona na wykres razem z zielon lini z zadania nr 4

```

Podsumowanie:

Z oblicze wynika, 偶e oraz p-value = 0.8423. Przyjmuj poziom istotnoci 
 = 0.05   Wsp贸czynnik dopasowania R2 =  0.9327 jest wikszy od R2  =  0.9141
z zadania nr 4. Zale偶no kwadratowa bdzie lepszym wyborem ni偶 zale偶no
liniowa (z zadania nr 4). Sugeruje to r贸wnie偶 wykres z zadania nr 5.
